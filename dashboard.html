<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Grow Funds Network</title>

<link rel="stylesheet" href="style.css">

<style>
.card{padding:20px;border-radius:10px;background:#151a33;margin-bottom:20px;}
.progress-bar{height:22px;background:#1c2240;border-radius:10px;overflow:hidden;margin-top:10px;}
.progress{height:100%;background:#00ffa6;width:0%;transition:width 0.5s;}
.crypto{display:flex;justify-content:space-around;margin-top:20px;flex-wrap:wrap;}
.crypto div{text-align:center;margin:10px;}
</style>
</head>
<body>

<h2 style="text-align:center;">Dashboard</h2>

<div class="card">
  <h3>Deposit / Upgrade Plan</h3>
  <label for="planSelect">Choose Plan:</label>
  <select id="planSelect">
    <option value="starter">Level 1: Starter ($10 - $97)</option>
    <option value="builder">Level 2: Builder ($100 - $999)</option>
    <option value="income">Level 3: Income ($1000 - $9999)</option>
    <option value="premium">Level 4: Premium ($10,000 - $99,999)</option>
    <option value="elite">Level 5: Elite ($100,000+)</option>
  </select>
  <input type="number" id="depositAmount" placeholder="Enter Deposit Amount">
  <button onclick="makeDeposit()">Submit Deposit</button>
  <p>Status: <span id="depositStatus">Incomplete</span></p>
  <div class="progress-bar"><div class="progress" id="depositProgress"></div></div>
  <p>Note: Actual payment details will be handled by support.</p>
</div>

<div class="card">
  <p><b>Email:</b> <span id="userEmail"></span></p>
  <p><b>Balance:</b> $<span id="userBalance"></span></p>
  <p><b>Plan:</b> <span id="userPlan"></span></p>
  <p><b>Referral Code:</b> <span id="referralCode"></span></p>
</div>

<div class="card">
  <h3>Plan Level Progress</h3>
  <div class="progress-bar"><div class="progress" id="progress"></div></div>
</div>

<div class="card">
  <h3>Referral Stats</h3>
  <p>Users Referred: <span id="refCount">0</span></p>
  <p>Referral Bonus Earned: $<span id="refBonus">0</span></p>
</div>

<div class="card">
  <h3>KYC Verification</h3>
  <input type="file" id="file"><br><br>
  <button onclick="uploadKYC()">Upload KYC</button>
</div>

<div class="card crypto">
  <div>
    <p>Bitcoin (BTC)</p>
    <p id="btcPrice">$0</p>
  </div>
  <div>
    <p>Ethereum (ETH)</p>
    <p id="ethPrice">$0</p>
  </div>
  <div>
    <p>Tether (USDT)</p>
    <p id="usdtPrice">$0</p>
  </div>
</div>

<script>
// ===== MongoDB + Termux backend integration =====
const userEmail = localStorage.getItem("userEmail");
if(!userEmail){
    alert("No user logged in!");
    window.location.href = "login.html";
}

// Display email
document.getElementById("userEmail").innerText = userEmail;

// Load user data from backend
async function loadDashboard(){
    try {
        const res = await fetch(`http://YOUR_PHONE_IP:3000/user/${userEmail}`);
        const data = await res.json();
        if(data.success){
            document.getElementById("userPlan").innerText = data.user.plan;
            document.getElementById("userBalance").innerText = data.user.deposit || 0;
            document.getElementById("referralCode").innerText = data.user.referral || "N/A";
            // Update progress bar
            const progressPercent = Math.min((data.user.deposit / 100000) * 100, 100);
            document.getElementById("depositProgress").style.width = progressPercent + "%";
            document.getElementById("depositStatus").innerText = progressPercent>0 ? "In Progress" : "Incomplete";
        } else {
            alert("Could not load user data: " + (data.message || data.error));
        }
    } catch(err){
        alert("Error connecting to server: " + err.message);
        console.error(err);
    }
}

// Call immediately
loadDashboard();

// ===== Deposit function (mock) =====
function makeDeposit(){
    const depositAmount = Number(document.getElementById("depositAmount").value);
    const plan = document.getElementById("planSelect").value;
    if(depositAmount>0){
        alert(`Deposit of $${depositAmount} submitted for plan ${plan}. Support will process it.`);
        document.getElementById("depositStatus").innerText = "In Progress";
        document.getElementById("depositProgress").style.width = "50%";
    } else{
        alert("Enter a valid deposit amount.");
    }
}

// ===== KYC Upload (mock) =====
function uploadKYC(){
    const file = document.getElementById("file").files[0];
    if(file){
        alert(`File ${file.name} uploaded. Support will verify KYC.`);
    } else{
        alert("Select a file to upload.");
    }
}
</script>

</body>
</html>